"use strict";angular.module("umbraco").controller("Koben.Iconic.Prevalues.Editor",function(n,t,i,r,u){function o(){t.get(u.convertVirtualToAbsolutePath("~/App_Plugins/Iconic/preconfigs.json")).then(function(t){n.preconfig=t.data.preconfigs},function(){f("iconicErrors_loading")})}function f(t){i.localize(t).then(function(t){n.error=t.value})}function e(n){var t={title:"Select file",section:"settings",treeAlias:"files",entityType:"file",filter:function(n){if(n.name.indexOf(".min.css")===-1&&n.name.indexOf(".css")===-1)return!0},filterCssClass:"not-allowed",close:function(){r.close()}},i=_.assign(t,n);r.treePicker(i)}function f(t){i.localize(t).then(function(t){n.error=t})}function s(i,r,e){n.error=null;(!i.selector||i.selector.length<=0)&&(e(),f("iconicErrors_selector"));i.sourcefile||(i.sourcefile=i.cssfile);var o=u.convertVirtualToAbsolutePath("~/"+i.sourcefile.replace("wwwroot",""));t.get(o).then(function(n){i.extractedStyles=[];for(var u=new RegExp(i.selector,"g"),t=u.exec(n.data);t!==null;)i.extractedStyles.push(t[1]),t=u.exec(n.data);i.extractedStyles.length>0?r():(f("iconicErrors_no_rules"),e())},function(){f("iconicErrors_loadingCss");e()})}n.configType="custom";n.selectedPreConfig=null;n.submit=function(){n.packageForm.$valid&&s(n.model["package"],function(){n.analysing="success";n.selectedPreConfig=null;n.model.saved&&n.model.saved();r.close()},function(){n.analysing="error"})};n.cancel=function(){n.model.cancel&&n.model.cancel();r.close()};n.changeConfigType=function(t){n.configType=t};n.toggleOverrideTemplate=function(){n.model["package"].overrideTemplate=!n.model["package"].overrideTemplate};n.openCssFilePicker=function(){var t={select:function(t){var i=unescape(t.id);n.model["package"].cssfile=i;r.close()}};e(t)};n.openRulesFilePicker=function(){var t={select:function(t){var i=unescape(t.id);n.model["package"].sourcefile=i;r.close()}};e(t)};n.selectPreConfig=function(t){Object.assign(n.model["package"],t)};n.removeCssFile=function(){n.model["package"].cssfile=null};n.removeRulesFile=function(){n.model["package"].sourcefile=null};o()});